# *******************************************************************************
# Copyright (c) 2025 Contributors to the Eclipse Foundation
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0
#
# SPDX-License-Identifier: Apache-2.0
# *******************************************************************************

name: Trigger bazel_registry_ui Update

on:
  push:
    branches:
      - main

jobs:
  dispatch-ui:
    if: ${{ github.event.repository.fork == false }}
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch repository event to bazel_registry_ui
        env:
          SCORE_BOT_CLASSIC_PAT: ${{ secrets.SCORE_BOT_CLASSIC_PAT }}
        run: |
          set -eu
          payload=$(printf '{"event_type":"on-bcr-trigger","client_payload":{"bcrCommitHash":"%s"}}' "$GITHUB_SHA")
          curl -fsS -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token $SCORE_BOT_CLASSIC_PAT" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/eclipse-score/bazel_registry_ui/dispatches \
            -d "$payload"
